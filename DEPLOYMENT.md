# Render Deployment Guide

## ðŸš€ Deploy Backend to Render

### Step 1: Prepare Repository
1. Push your backend code to GitHub
2. Make sure all files are committed

### Step 2: Create Render Account
1. Go to [render.com](https://render.com)
2. Sign up with GitHub
3. Connect your repository

### Step 3: Create Web Service
1. Click "New +" â†’ "Web Service"
2. Connect your GitHub repository
3. Select the `backend` folder
4. Configure:
   - **Name**: `caffeinated-thoughts-backend`
   - **Environment**: `Node`
   - **Build Command**: `npm install && npm run build && npx prisma generate && npx prisma migrate deploy`
   - **Start Command**: `npm start`
   - **Health Check Path**: `/health`

### Step 4: Create Database
1. Click "New +" â†’ "PostgreSQL"
2. Configure:
   - **Name**: `caffeinated-thoughts-db`
   - **Database**: `caffeinated_thoughts`
   - **User**: `caffeinated_user`
   - **Plan**: Free

### Step 5: Environment Variables
Add these environment variables in Render Dashboard:

#### Required Variables:
```
NODE_ENV=production
PORT=10000
DATABASE_URL=<auto-generated by Render>
JWT_ACCESS_TOKEN_SECRET=<generate random string>
JWT_REFRESH_TOKEN_SECRET=<generate random string>
ACCESS_TOKEN_EXPIRES_IN=15m
REFRESH_TOKEN_EXPIRES_IN=30d
```

#### M-Pesa Configuration:
```
MPESA_ENV=production
MPESA_CONSUMER_KEY=UHZS7avkeToeVOL88w6SzDpFw0fz0EDm6lPMbQmaGFLhXVb3
MPESA_CONSUMER_SECRET=IuZf4gdxaOgGuMW1WERPJKLy7ANqsSIKYYnbSBrMldAb4wpJmfxNbJcc1psR5vjE
MPESA_SHORTCODE=3559865
MPESA_PASSKEY=eb821181ea78e9378dd2edffc2a0c1b4ca05883dc1f5d4025ddd0b096f1ae2b6
MPESA_CALLBACK_URL=https://your-render-app.onrender.com/api/v1/payments/callback
MIN_COFFEE_AMOUNT=50
```

#### CORS & Admin:
```
CORS_ORIGIN=https://patch-notes-dev.vercel.app,https://caffeinated-thoughts-five.vercel.app,http://localhost:8080
ADMIN_EMAIL=kelvinmukaria2023@gmail.com
ADMIN_PASSWORD=Kevdev@2025
```

### Step 6: Deploy
1. Click "Create Web Service"
2. Wait for deployment to complete
3. Note your app URL (e.g., `https://caffeinated-thoughts-backend.onrender.com`)

### Step 7: Update Frontend
Update your Vercel environment variable:
- **Name**: `VITE_API_URL`
- **Value**: `https://your-render-app.onrender.com/api/v1`

### Step 8: Test
1. Test your deployed backend: `https://your-render-app.onrender.com/health`
2. Test your Vercel frontend with the new backend URL
3. Test M-Pesa payments

## ðŸ”§ Troubleshooting

### Common Issues:
1. **Build fails**: Check Node.js version (should be 18+)
2. **Database connection**: Ensure DATABASE_URL is set correctly
3. **CORS errors**: Update CORS_ORIGIN with your frontend URL
4. **M-Pesa callbacks**: Update MPESA_CALLBACK_URL with your Render URL

### Logs:
- Check Render dashboard logs for deployment issues
- Use `render logs` CLI command for real-time logs
